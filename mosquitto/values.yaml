# Default values for mosquitto.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Container image configuration
image:
  # -- Image repository
  repository: eclipse-mosquitto
  # -- Image tag
  tag: "2.0.22"
  # -- Image pull policy
  pullPolicy: IfNotPresent

# -- Image pull secrets for private registries
imagePullSecrets: []

# -- Override the chart name
nameOverride: ""
# -- Override the full release name
fullnameOverride: ""

# -- Pod annotations applied to the broker pod
podAnnotations: {}
# -- Extra labels applied to the broker pod
podLabels: {}

# -- Pod-level security context
podSecurityContext: {}
  # fsGroup: 2000

# -- Container-level security context
securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

# -- Resource requests and limits
resources: {}
  # limits:
  #   cpu: 100m
  #   memory: 128Mi
  # requests:
  #   cpu: 100m
  #   memory: 128Mi

# Service configuration
service:
  # -- Service type (ClusterIP/LoadBalancer/NodePort)
  type: ClusterIP
  # -- Service annotations for load balancer configuration
  annotations: {}
  # -- Static IP for LoadBalancer services
  loadBalancerIP: ""
  # -- Allowed source ranges for LoadBalancer
  loadBalancerSourceRanges: []
  # -- Preserve client IP for LoadBalancer/NodePort
  externalTrafficPolicy: Cluster
  # -- Session affinity mode
  sessionAffinity: None

  # MQTT/WebSocket port configuration
  ports:
    # Plain MQTT port
    mqtt:
      # -- Enable plain MQTT port
      enabled: true
      # -- MQTT port number
      port: 1883
      # -- Target port in the pod
      targetPort: 1883
      # -- Protocol used by the service
      protocol: TCP
      # -- NodePort for NodePort service type (leave empty for auto-assignment)
      nodePort: ""
    # MQTT over TLS port
    mqttTls:
      # -- Enable MQTT over TLS port
      enabled: false
      # -- MQTT over TLS port number
      port: 8883
      # -- Target port in the pod
      targetPort: 8883
      # -- Protocol used by the service
      protocol: TCP
      # -- NodePort for NodePort service type (leave empty for auto-assignment)
      nodePort: ""
      tls:
        # -- Secret containing TLS certificates
        secretName: ""
        # -- CA certificate key in the secret
        caFile: "ca.crt"
        # -- Server certificate key in the secret
        certFile: "tls.crt"
        # -- Server private key key in the secret
        keyFile: "tls.key"
    # MQTT over WebSocket port
    websocket:
      # -- Enable MQTT over WebSocket port
      enabled: false
      # -- MQTT over WebSocket port number
      port: 9001
      # -- Target port in the pod
      targetPort: 9001
      # -- Protocol used by the service
      protocol: TCP
      # -- NodePort for NodePort service type (leave empty for auto-assignment)
      nodePort: ""

# Host networking configuration
hostNetwork:
  # -- Enable host networking (pod uses node network namespace)
  enabled: false
  # -- DNS policy when using host networking
  dnsPolicy: ClusterFirstWithHostNet

# Host port configuration (alternative to hostNetwork)
hostPorts:
  # -- Enable hostPort configuration
  enabled: false
  mqtt:
    # -- Host port for plain MQTT (leave empty to disable)
    port: ""
    # -- Specific host IP to bind (empty = all interfaces)
    hostIP: ""
  mqttTls:
    # -- Host port for TLS MQTT
    port: ""
    # -- Specific host IP to bind (empty = all interfaces)
    hostIP: ""
  websocket:
    # -- Host port for WebSocket MQTT
    port: ""
    # -- Specific host IP to bind (empty = all interfaces)
    hostIP: ""

# Only needed for WebSocket connections (HTTP-based MQTT)
ingress:
  # -- Enable ingress for WebSocket port
  enabled: false
  # -- Ingress class name
  className: ""
  # -- Additional ingress annotations
  annotations: {}
  # -- Ingress rules configuration
  hosts:
    - host: mosquitto.local
      paths:
        - path: /mqtt
          pathType: Prefix
          service:
            name: websocket  # Only websocket port is HTTP-compatible
  # -- TLS configuration for ingress
  tls: []

# -- Liveness probe
livenessProbe:
  tcpSocket:
    port: mqtt
  initialDelaySeconds: 30
  periodSeconds: 10

# -- Readiness probe
readinessProbe:
  tcpSocket:
    port: mqtt
  initialDelaySeconds: 5
  periodSeconds: 5

# Mosquitto broker configuration
config:
  # -- Allow anonymous connections (auto-disabled when users are defined)
  allowAnonymous: true
  # -- Broker log level
  logLevel: information
  # -- Max concurrent client connections (0 = unlimited)
  maxConnections: 0
  # -- Additional configuration appended verbatim
  extraConfig: ""

# Authentication settings
auth:
  # -- Inline users/passwords stored in ConfigMap (development/testing)
  users: []
    # - username: admin
    #   password: admin123
    # - username: user1
    #   passwordHash: "$6$..."
  # Secret reference for users/passwords (preferred for production)
  secretRef:
    # -- Name of secret containing passwd file (takes precedence over users)
    name: ""
    # -- Key in the secret containing passwd file content
    key: "passwd"
  # -- ACL entries in Mosquitto ACL file format
  acls: ""

# Persistent storage configuration
persistence:
  # -- Enable persistent volume for Mosquitto data
  enabled: false
  # -- Storage class for PVC (set to "-" to disable dynamic provisioning)
  storageClass: ""
  # -- Access modes for the PVC
  accessModes:
    - ReadWriteOnce
  # -- Requested PVC size
  size: 1Gi
  # -- Use an existing PVC instead of creating a new one
  existingClaim: ""
  # -- Annotations for PVC
  annotations: {}

# -- Node selector for scheduling
nodeSelector: {}

# -- Pod tolerations
tolerations: []

# -- Pod affinity / anti-affinity rules
affinity: {}
